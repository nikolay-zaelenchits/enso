---
import Button from "../button/Button.astro";
---

<div class="news-wr">
    <div class="news">
        <div class="news-box">
            <div class="news-list">
                <div class="news-list-title">NEWS</div>
                <div id="news-list" class="news-list-items">
                    <!--
                                        <div class="news-item" data-idx="1">
                                            <div class="news-item-title">ENSO'S INNOVATION FEATURED BY REUTERS</div>
                                            <div class="news-item-txt">FOR EVS TO BE SUCCESSFUL AT SCALE THEY NEED BETTER TYRES</div>
                                        </div>
                                        <div class="news-item" data-idx="2">
                                            <div class="news-item-title">ENSO LAUNCHES LONDON STORE FOR ELECTRIC TAXIS</div>
                                            <div class="news-item-txt">OFFERING RANGE-EXTENDING EV TYRES FOR LONDON TAXI MARKET</div>
                                        </div>
                                        <div class="news-item" data-idx="2">ENSO has launches its tyre store in London, offering its range-extending EV tyres to the London electric taxi market.</div>
                                        <div class="news-item" data-idx="3">ENSO is proud to announce its innovative Pay-Per-Mile tyre for LEVC London electric taxis, to be launched in collaboration with ZETI, our digital fleet financing partner.</div>
                                        <div class="news-item" data-idx="4">Enso Tyres is delighted to announce that it has been nominated to The Earthshot Prize, in the 'Clean Your Air' category. Thank you Cranfield University!</div>
                    -->
                </div>
                <div class="news-list-btn-row">
                    <Button>View All</Button>
                </div>
            </div>
            <div id="news-img-box" class="news-img-box">
                <!--                <div class="news-img news-img-1 play"></div>
                                <div class="news-img news-img-2"></div>
                                <div class="news-img news-img-3"></div>
                                <div class="news-img news-img-4"></div>-->
            </div>
        </div>
    </div>
</div>

<script>
    async function fetchAsync(url) {
        let response = await fetch(url);
        let data = await response.json();
        return data;
    }

    function htmlToElement(html) {
        var template = document.createElement('template');
        template.innerHTML = html;
        return template.content.firstChild;
    }

    const newsHoverAction = (idx: number) => {
        const currentImg = document.querySelector('.news-img.play');
        const newImg = document.querySelector(`#news-img-box .news-img:nth-child(${++idx})`);

        if (currentImg) {
            currentImg.classList.remove('play');
        }

        if (newImg) {
            newImg.classList.add('play');
        }
    }

    const addEvent = () => {
        const newsListBox = document.getElementById('news-list');

        newsListBox.querySelectorAll('.news-item').forEach(node => node.addEventListener(
            "mouseenter",
            (event) => {
                const idx = event.target.dataset.idx;
                newsHoverAction(idx);
            },
            false,
        ));
    }

    const loadNews = async () => {
        const news = await fetchAsync('https://ensotyres.com/wp/wp-json/api/posts');
        const newsListBox = document.getElementById('news-list');
        const newsImgBox = document.getElementById('news-img-box');

        newsListBox.innerHTML = "";
        newsImgBox.innerHTML = "";
        for (let i = 0; i < 4 && i < news.length; i++) {
            let newsItem = news[i];
            let htmlNewsTxtString = `<div class="news-item" data-idx="${i}"><div class="news-item-title">${newsItem.title}</div><div class="news-item-txt">${newsItem.excerpt}</div><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><polygon points="7 7 15.586 7 5.293 17.293 6.707 18.707 17 8.414 17 17 19 17 19 5 7 5 7 7"/></svg></div>`;
            newsListBox.appendChild(htmlToElement(htmlNewsTxtString));

            // let htmlNewsImgString = `<div class="news-img" style={"background-image: url("${newsItem.image}")"}></div>`;
            newsImgBox.innerHTML = `${newsImgBox.innerHTML}<div class="news-img" style='background-image: url(${newsItem.image});'></div>`;
        }
        newsHoverAction(0);

        addEvent();
    }

    loadNews();

</script>

<style lang="scss" is:global>
    .news-wr {
        background-color: var(--clr-lightest);

        padding-left: 90px;
        padding-right: 90px;

        @media only screen and (max-width: 1100px) {
            padding-left: 25px;
            padding-right: 25px;
        }

        .news {
            height: 80vh;
            min-height: 440px;

            .news-box {
                height: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;

                .news-list {
                    width: 50%;

                    .news-list-title {
                        font-size: 36px;
                        font-weight: bold;
                    }

                    .news-list-items {
                        padding: 20px 20px 20px 0;

                        .news-item {
                            display: block;
                            position: relative;
                            padding: 20px 110px 20px 0;

                            font-weight: bold;

                            cursor: pointer;

                            color: grey;
                            text-decoration: none;

                            transition: all .7s;

                            .news-item-title {
                                font-size: 16px;
                                //font-family: BrandonGrotesque;
                            }

                            .news-item-txt {
                                font-family: BrandonGrotesque;
                                font-size: 14px;
                                font-weight: normal;
                            }

                            svg {
                                position: absolute;
                                height: 30px;
                                transform: rotate(45deg);
                                right: 70px;
                                top: 0;
                                bottom: 0;
                                margin: auto;
                                //opacity: .5;
                                transition: all .7s;
                                color: lightgray;
                            }

                            &:hover {
                                color: var(--clr-darker);

                                svg {
                                    //opacity: 1;
                                    right: 30px;
                                    color: var(--clr-darker);
                                }
                            }

                            @media only screen and (max-width: 1100px) {
                                padding-right: 55px;

                                svg {
                                    right: 25px;
                                }

                                &:hover {
                                    svg {
                                        right: 0;
                                    }
                                }
                            }
                        }
                    }

                    .news-list-btn-row {
                        display: flex;
                    }
                }

                .news-img-box {
                    width: 50%;
                    height: 80%;

                    position: relative;

                    .news-img {
                        position: absolute;
                        //width: 100%;
                        //height: 100%;

                        $offset: 30px;

                        top: -$offset;
                        bottom: $offset;
                        //left: $offset;
                        //right: $offset;
                        left: 0;
                        right: 0;

                        background-position: center center;
                        background-size: cover;

                        opacity: 0;
                        transition: all 1.5s;

                        &.play {
                            opacity: 1;
                            top: 0;
                            bottom: 0;
                            left: 0;
                            right: 0;
                        }

                        &.news-img-1 {
                            background-image: url("/img/news1.jpg");
                        }

                        &.news-img-2 {
                            background-image: url("/img/news2.jpeg");
                        }

                        &.news-img-3 {
                            background-image: url("/img/news3.jpg");
                        }

                        &.news-img-4 {
                            background-image: url("/img/news4.jpg");
                        }
                    }

                }
            }
        }
    }
</style>
